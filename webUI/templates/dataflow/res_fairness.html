{% load static %}
<head>
    <!-- Bootstrap Core CSS -->
    <link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="{% static 'metisMenu/metisMenu.min.css' %}" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="{% static 'sbadmin/css/sb-admin-2.css' %}" rel="stylesheet">

    <!-- Morris Charts CSS -->
    <link href="{% static 'morrisjs/morris.css' %}" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="{% static 'font-awesome/css/font-awesome.min.css' %}" rel="stylesheet" type="text/css">

    <!-- jQuery -->
    <script src="{% static 'jquery/jquery-3.2.1.min.js' %}"></script>
    <!-- Highcharts JavaScript -->
    <script src="{% static 'highcharts/code/highcharts.js' %}"></script>
    <script src="{% static 'highcharts/code/modules/exporting.js' %}"></script>
    <script src="https://code.highcharts.com/modules/gray.js"></script>

</head>

<body>
<div id="wrapper">
    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand"><h4>Ranking facts</h4></a>
        </div>
        <!-- /.navbar-header -->

        <ul class="nav navbar-top-links navbar-right">
            <div>
                <img src="{% static 'images/header_logo_grey_small.jpg' %}" class="img-responsive"
                     style="padding-top: 5px">
            </div>
        </ul>
        <!-- /.navbar-top-links -->

        <div class="navbar-default sidebar" role="navigation">
            <div class="sidebar-nav navbar-collapse">
                <ul class="nav" id="side-menu">
                    <li>
                        <a href="{% url 'dataflow:nutrition_facts' %}"><i class="fa fa-dashboard fa-fw"></i> Ranking
                            Facts</a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-wrench fa-fw"></i> Additional results<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="{% url 'dataflow:res_personal' %}"><i class="fa fa-table fa-fw"></i> Personal ranking information</a>
                            </li>
                            <li>
                                <a href="{% url 'dataflow:res_fairness' %}"><i class="fa fa-table fa-fw"></i> Fairness in ranking</a>
                            </li>
                        </ul>
                        <!-- /.nav-second-level -->
                    </li>
                </ul>
            </div>
            <!-- /.sidebar-collapse -->
        </div>
        <!-- /.navbar-static-side -->
    </nav>


    <div id="page-wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">Fairness Validation</h1>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->
        <form role="form" action="" onsubmit="return validateCheckedAtt()" method="post"> {% csrf_token %}
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        Specify fairness constraints
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <div class="form-group" id="sensi_checkboxes">
                            <label>Check all the sensitive attributes</label> &nbsp;&nbsp;
                            {% for atti_name,atti_id in passed_zip_atts %}
                            <label class="checkbox-inline">
                                <input type='hidden' name="{{atti_id | safe}}_sensi_checks" value="{{atti_name | safe}}_unchecked">
                                <input id="{{atti_id | safe}}_sensi_checks" name="{{atti_id | safe}}_sensi_checks" type="checkbox" value="{{atti_name | safe}}"> {{ atti_name }}
                            </label>
                            {% endfor %}
                        </div>
                    </div>
                    <!-- /.panel-body -->
                    <div class="panel-footer">
                        <div class="form-inline" align="center">
                            <button id="fairness_check" type="submit" class="btn btn-primary">Run fairness check</button>
                        </div>
                    </div>
                </div>
                <!-- /.panel -->
            </div>
        </div><!-- /.row -->
        </form>
        {% if passed_fair_table != "false" %}
        <div class="row">
            <div class="col-lg-12">
                 <div class="panel panel-warning">
                    <div class="panel-heading">
                        <span class="pull-left"><i class="fa fa-bell fa-2x"></i></span>
                        <span>&nbsp;&nbsp;</span>
                        Pairwise fairness results
                        <span class="pull-right">
                            <a href="#" data-toggle="tooltip"><i class="fa fa-question-circle fa-2x"></i></a>
                        </span>
                    </div>
                    <div class="panel-body">
                        {% for atti_name,atti_pair in passed_fair_table.items  %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>{{atti_name}}</th>
                                        <th>Current number of pairs in generated ranking</th>
                                        <th>Estimated number of pairs based on input data</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for vali,pairs_vali in atti_pair.items %}
                                        {% if pairs_vali.0 >= pairs_vali.1 %}
                                        <tr class="bg-success">
                                            <td>{{ vali }}</td>
                                            <td>{{ pairs_vali.0 }}</td>
                                            <td>{{ pairs_vali.1 }}</td>
                                        </tr>
                                        {% else %}
                                        <tr class="bg-danger">
                                            <td>{{ vali }}</td>
                                            <td>{{ pairs_vali.0 }}</td>
                                            <td>{{ pairs_vali.1 }}</td>
                                        </tr>
                                        {% endif %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <!-- /.table-responsive -->
                        {% endfor %}
                    </div><!-- /.panel-body -->
                    <div class="panel-footer">
                        <span class="pull-left">
                            <i class="fa fa-question-circle fa-2x"></i>
                        </span>
                        <span>&nbsp;&nbsp;</span>
                        NOTICE: Pairs is (Value > *).
                        The ranking is fair to this value when number of current pairs is greater than estimates number of pairs!
                        Values that are fair in the generated ranking have green background!
                    </div>
                 </div><!-- /.panel -->
            </div>
        </div><!-- /.row -->
        {% endif %}
        <div class="row">
            <div class="col-lg-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        Race in top 10
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <div class="flot-chart">
                            <div class="flot-chart-content" id="flot-pie-chart"></div>
                        </div>
                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.panel -->
            </div>
            <div class="col-lg-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        Race in overall
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <div class="flot-chart">
                            <div class="flot-chart-content" id="flot-pie-chart2"></div>
                        </div>
                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.panel -->
            </div>
        </div>
        <!-- /.row -->
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div class="form-inline" align="center">
                            {% if passed_unprocessing_flag %}
                            <a href="{% url 'dataflow:data_process' %}" class="btn btn-default btn-lg">
                                <span class="glyphicon glyphicon-menu-left"></span>
                                Previous step (Parameter Settings)</a>
                            {% else %}
                            <a href="{% url 'dataflow:norm_process' %}" class="btn btn-default btn-lg">
                                <span class="glyphicon glyphicon-menu-left"></span>
                                Previous step (Parameter Settings)</a>
                            {% endif %}
                            <a href="{% url 'dataflow:base' %}" class="btn btn-default btn-lg">
                                Upload new data
                                <span class="glyphicon glyphicon-menu-right"></span></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.row -->
    </div>
    <!-- /#page-wrapper -->
</div>
<!-- /#wrapper -->
<!-- validation for rank preview function when submit parameters-->
<script type="text/javascript" language="javascript">
    // validation check when click fairness check button
    var all_att_ids = {{passed_column_ids | safe}};
    function validateCheckedAtt() {
        var choose_att_flag = "false";
        for (i in all_att_ids) {
           var checks_id = all_att_ids[i] + "_sensi_checks";

           if (document.getElementById(checks_id).checked) {
               choose_att_flag = "true";
           }
        }
        if (choose_att_flag=="false") {
            alert('You need to specify at least one sensitive attribute to check!');
            return false;
        }
        else{
           return true;
        }
    }//end of validation function
</script>
<!-- update users' checked boxes after user click fairness check button-->
<script type="text/javascript" language="javascript">
    var fair_table_flag={{passed_fair_table | safe}};
    var choosed_atts_ids = {{passed_checked_atts_ids |safe}};

    $(document).ready(function () {
        if (fair_table_flag){
            for (i in choosed_atts_ids) {
                var checks_id = choosed_atts_ids[i]+"_sensi_checks";
                document.getElementById(checks_id).checked = true;
            }
        }
    });
</script>
<!-- toolip setting-->
<script>
$(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip({
        title: 'Pairs is (Value > *). The ranking is fair to this value when number of current pairs is greater than estimates number of pairs! Values that are fair in the generated ranking have green background!',
    });
});
</script>
<!-- Bootstrap Core JavaScript -->
<script src="{% static 'bootstrap/js/bootstrap.min.js' %}"></script>

<!-- Flot Charts JavaScript -->
<script src="{% static 'flot/excanvas.min.js' %}"></script>
<script src="{% static 'flot/jquery.flot.js' %}"></script>
<script src="{% static 'flot/jquery.flot.pie.js' %}"></script>
<script src="{% static 'flot/jquery.flot.resize.js' %}"></script>
<script src="{% static 'flot/jquery.flot.time.js' %}"></script>
<script src="{% static 'flot-tooltip/jquery.flot.tooltip.min.js' %}"></script>
<script src="{% static 'flot/flot-data.js' %}"></script>

</body>